<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wakedonalds ‚Äî POS</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg:#faf8f5; --white:#ffffff; --ink:#1a1714; --ink2:#4a4540;
            --muted:#9e9890; --border:#e8e4de; --accent:#c8913a;
            --accent-light:#f5ead8; --accent-dark:#a6722a; --red:#d94f3d;
            --green:#3d8c5c; --surface:#f2ede6;
            --shadow:0 2px 16px rgba(26,23,20,0.08);
            --shadow-lg:0 8px 40px rgba(26,23,20,0.12);
        }
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--ink);min-height:100vh;}
        .view{display:none;} .view.active{display:flex;}
        #view-menu{min-height:100vh;flex-direction:column;}
        .nav{position:sticky;top:0;z-index:100;background:var(--white);border-bottom:1px solid var(--border);padding:0 32px;display:flex;align-items:center;justify-content:space-between;height:64px;box-shadow:0 1px 0 var(--border);}
        .logo{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:600;letter-spacing:0.04em;}
        .logo span{color:var(--accent);font-style:italic;}
        .nav-center{font-size:13px;color:var(--muted);}
        .nav-right{display:flex;align-items:center;gap:12px;}
        .btn-admin{font-size:12px;font-weight:500;letter-spacing:0.06em;text-transform:uppercase;color:var(--muted);background:none;border:1px solid var(--border);border-radius:6px;padding:7px 14px;cursor:pointer;transition:all 0.2s;}
        .btn-admin:hover{color:var(--ink);border-color:var(--ink2);}
        .btn-logout{font-size:12px;font-weight:500;letter-spacing:0.06em;text-transform:uppercase;color:var(--red);background:none;border:1px solid var(--red);border-radius:6px;padding:7px 14px;cursor:pointer;transition:all 0.2s;}
        .btn-logout:hover{background:var(--red);color:white;}
        .cart-btn{background:var(--accent);color:white;border:none;border-radius:8px;padding:9px 20px;font-family:'Outfit',sans-serif;font-size:14px;font-weight:500;cursor:pointer;display:flex;align-items:center;gap:10px;transition:background 0.2s,transform 0.1s;}
        .cart-btn:hover{background:var(--accent-dark);}
        .cart-btn:active{transform:scale(0.97);}
        .cart-count{background:white;color:var(--accent);border-radius:12px;min-width:22px;height:22px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;}
        .category-bar{background:var(--white);border-bottom:1px solid var(--border);padding:0 32px;display:flex;gap:4px;overflow-x:auto;scrollbar-width:none;}
        .category-bar::-webkit-scrollbar{display:none;}
        .cat-tab{padding:14px 20px;font-size:13px;font-weight:500;color:var(--muted);border:none;background:none;cursor:pointer;white-space:nowrap;border-bottom:2px solid transparent;transition:all 0.2s;}
        .cat-tab:hover{color:var(--ink);}
        .cat-tab.active{color:var(--accent);border-bottom-color:var(--accent);}
        .menu-body{flex:1;padding:32px;max-width:1100px;margin:0 auto;width:100%;}
        .section-title{font-family:'Cormorant Garamond',serif;font-size:32px;font-weight:600;margin-bottom:6px;}
        .section-sub{font-size:13px;color:var(--muted);margin-bottom:24px;}
        .menu-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin-bottom:48px;}
        .menu-card{background:var(--white);border:1px solid var(--border);border-radius:12px;overflow:hidden;transition:transform 0.2s,box-shadow 0.2s;animation:fadeUp 0.4s ease both;}
        .menu-card:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg);}
        .menu-card-img{width:100%;height:160px;background:var(--surface);display:flex;align-items:center;justify-content:center;font-size:52px;}
        .menu-card-body{padding:16px;}
        .menu-card-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px;}
        .menu-card-name{font-weight:600;font-size:15px;line-height:1.3;}
        .menu-card-price{font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:600;color:var(--accent);white-space:nowrap;margin-left:12px;}
        .menu-card-desc{font-size:12px;color:var(--muted);line-height:1.5;margin-bottom:14px;}
        .tag{display:inline-block;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:0.08em;padding:3px 8px;border-radius:4px;margin-right:4px;margin-bottom:10px;}
        .tag-veg{background:#e8f5ee;color:var(--green);}
        .tag-spicy{background:#fdecea;color:var(--red);}
        .tag-popular{background:var(--accent-light);color:var(--accent-dark);}
        .add-btn{width:100%;background:var(--ink);color:white;border:none;border-radius:8px;padding:10px;font-family:'Outfit',sans-serif;font-size:13px;font-weight:500;cursor:pointer;transition:background 0.2s;display:flex;align-items:center;justify-content:center;gap:6px;}
        .add-btn:hover{background:var(--accent);}
        #view-cart{min-height:100vh;flex-direction:column;}
        .page-header{background:var(--white);border-bottom:1px solid var(--border);padding:0 32px;height:64px;display:flex;align-items:center;gap:16px;}
        .back-btn{background:none;border:1px solid var(--border);border-radius:8px;padding:8px 14px;cursor:pointer;font-family:'Outfit',sans-serif;font-size:13px;color:var(--ink2);transition:all 0.2s;}
        .back-btn:hover{border-color:var(--ink);color:var(--ink);}
        .page-title{font-family:'Cormorant Garamond',serif;font-size:24px;font-weight:600;}
        .cart-layout{display:grid;grid-template-columns:1fr 360px;gap:24px;padding:32px;max-width:1100px;margin:0 auto;width:100%;align-items:start;}
        @media(max-width:768px){.cart-layout{grid-template-columns:1fr;}}
        .cart-items-panel{background:var(--white);border:1px solid var(--border);border-radius:12px;overflow:hidden;}
        .panel-head{padding:16px 20px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;letter-spacing:0.04em;text-transform:uppercase;color:var(--muted);}
        .cart-item{display:flex;align-items:center;gap:14px;padding:16px 20px;border-bottom:1px solid var(--border);animation:fadeUp 0.3s ease both;}
        .cart-item:last-child{border-bottom:none;}
        .cart-item-emoji{font-size:32px;width:48px;text-align:center;}
        .cart-item-info{flex:1;}
        .cart-item-name{font-weight:600;font-size:14px;margin-bottom:2px;}
        .cart-item-unit{font-size:12px;color:var(--muted);}
        .qty-control{display:flex;align-items:center;border:1px solid var(--border);border-radius:8px;overflow:hidden;}
        .qty-btn{width:32px;height:32px;border:none;background:var(--surface);cursor:pointer;font-size:16px;color:var(--ink);transition:background 0.15s;display:flex;align-items:center;justify-content:center;}
        .qty-btn:hover{background:var(--border);}
        .qty-num{width:36px;text-align:center;font-size:14px;font-weight:600;background:white;color:var(--ink);}
        .cart-item-total{font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:600;min-width:60px;text-align:right;}
        .remove-btn{background:none;border:none;color:var(--muted);cursor:pointer;font-size:18px;padding:4px;border-radius:4px;transition:color 0.2s;}
        .remove-btn:hover{color:var(--red);}
        .summary-panel{background:var(--white);border:1px solid var(--border);border-radius:12px;overflow:hidden;position:sticky;top:80px;}
        .summary-rows{padding:20px;display:flex;flex-direction:column;gap:12px;}
        .summary-row{display:flex;justify-content:space-between;font-size:14px;color:var(--ink2);}
        .summary-row.total{padding-top:12px;border-top:1px solid var(--border);font-weight:600;font-size:16px;color:var(--ink);}
        .summary-row.total .val{font-family:'Cormorant Garamond',serif;font-size:22px;color:var(--accent);}
        .customer-form{padding:20px;border-top:1px solid var(--border);}
        .form-label{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.08em;color:var(--muted);margin-bottom:6px;display:block;}
        .form-input{width:100%;padding:10px 14px;border:1px solid var(--border);border-radius:8px;font-family:'Outfit',sans-serif;font-size:14px;color:var(--ink);background:var(--bg);outline:none;transition:border-color 0.2s;margin-bottom:12px;}
        .form-input:focus{border-color:var(--accent);}
        .checkout-btn{width:100%;background:var(--accent);color:white;border:none;border-radius:10px;padding:14px;font-family:'Outfit',sans-serif;font-size:15px;font-weight:600;cursor:pointer;transition:background 0.2s;margin-top:4px;}
        .checkout-btn:hover{background:var(--accent-dark);}
        .empty-cart{padding:60px 20px;text-align:center;color:var(--muted);}
        .empty-cart .icon{font-size:48px;margin-bottom:12px;}
        .empty-cart p{font-size:14px;}
        #view-admin{min-height:100vh;flex-direction:column;}
        .admin-layout{display:flex;flex:1;min-height:calc(100vh - 64px);}
        .admin-sidebar{width:220px;background:var(--ink);color:white;padding:24px 0;flex-shrink:0;}
        .sidebar-logo{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:600;color:white;padding:0 20px 24px;border-bottom:1px solid rgba(255,255,255,0.1);margin-bottom:12px;}
        .sidebar-logo span{color:var(--accent);font-style:italic;}
        .sidebar-link{display:flex;align-items:center;gap:10px;padding:11px 20px;font-size:13px;font-weight:500;color:rgba(255,255,255,0.6);cursor:pointer;transition:all 0.15s;border-left:3px solid transparent;}
        .sidebar-link:hover{color:white;background:rgba(255,255,255,0.06);}
        .sidebar-link.active{color:white;background:rgba(200,145,58,0.15);border-left-color:var(--accent);}
        .admin-main{flex:1;padding:32px;overflow-y:auto;}
        .admin-section{display:none;} .admin-section.active{display:block;}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:32px;}
        .stat-card{background:var(--white);border:1px solid var(--border);border-radius:12px;padding:20px;animation:fadeUp 0.4s ease both;}
        .stat-label{font-size:12px;color:var(--muted);font-weight:500;text-transform:uppercase;letter-spacing:0.06em;margin-bottom:8px;}
        .stat-value{font-family:'Cormorant Garamond',serif;font-size:32px;font-weight:600;}
        .stat-sub{font-size:12px;color:var(--green);margin-top:4px;}
        .admin-toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
        .admin-h2{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:600;}
        .btn-primary{background:var(--accent);color:white;border:none;border-radius:8px;padding:9px 18px;font-family:'Outfit',sans-serif;font-size:13px;font-weight:500;cursor:pointer;transition:background 0.2s;display:flex;align-items:center;gap:6px;}
        .btn-primary:hover{background:var(--accent-dark);}
        .admin-table{width:100%;background:var(--white);border:1px solid var(--border);border-radius:12px;overflow:hidden;border-collapse:collapse;}
        .admin-table th{background:var(--surface);padding:12px 16px;text-align:left;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.08em;color:var(--muted);border-bottom:1px solid var(--border);}
        .admin-table td{padding:14px 16px;font-size:14px;border-bottom:1px solid var(--border);color:var(--ink2);vertical-align:middle;}
        .admin-table tr:last-child td{border-bottom:none;}
        .admin-table tr:hover td{background:var(--bg);}
        .status-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:600;}
        .badge-active{background:#e8f5ee;color:var(--green);}
        .badge-off{background:#fdecea;color:var(--red);}
        .action-btns{display:flex;gap:6px;}
        .icon-btn{background:none;border:1px solid var(--border);border-radius:6px;padding:5px 10px;cursor:pointer;font-size:13px;color:var(--ink2);transition:all 0.15s;}
        .icon-btn:hover{border-color:var(--accent);color:var(--accent);}
        .icon-btn.danger:hover{border-color:var(--red);color:var(--red);}
        .modal-overlay{position:fixed;inset:0;background:rgba(26,23,20,0.5);z-index:1000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
        .modal-overlay.open{display:flex;}
        .modal{background:white;border-radius:16px;padding:32px;width:480px;max-width:90vw;box-shadow:var(--shadow-lg);animation:modalIn 0.25s ease both;}
        .modal-title{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:600;margin-bottom:20px;}
        .modal-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
        .modal-grid .full{grid-column:1/-1;}
        .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:24px;}
        .btn-secondary{background:none;border:1px solid var(--border);border-radius:8px;padding:9px 18px;font-family:'Outfit',sans-serif;font-size:13px;cursor:pointer;color:var(--ink2);transition:all 0.2s;}
        .btn-secondary:hover{border-color:var(--ink);color:var(--ink);}
        .success-overlay{position:fixed;inset:0;background:rgba(26,23,20,0.6);z-index:2000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(6px);}
        .success-overlay.open{display:flex;}
        .success-card{background:white;border-radius:20px;padding:48px 40px;text-align:center;max-width:400px;width:90%;animation:modalIn 0.3s ease both;}
        .success-icon{font-size:56px;margin-bottom:16px;}
        .success-title{font-family:'Cormorant Garamond',serif;font-size:32px;font-weight:600;margin-bottom:8px;}
        .success-sub{color:var(--muted);font-size:14px;margin-bottom:28px;line-height:1.6;}
        .success-order{background:var(--surface);border-radius:10px;padding:20px;margin-bottom:24px;font-size:14px;color:var(--ink2);text-align:left;}
        .success-order .order-label{font-size:11px;text-transform:uppercase;letter-spacing:0.08em;color:var(--muted);margin-bottom:4px;}
        .success-order .order-value{font-weight:600;color:var(--ink);margin-bottom:12px;}
        .success-order .order-value:last-of-type{margin-bottom:0;}
        .success-order .order-items{border-top:1px solid var(--border);padding-top:12px;margin-top:12px;}
        .success-order .order-item{display:flex;justify-content:space-between;padding:6px 0;font-size:13px;}
        .success-order .order-item-name{color:var(--ink);}
        .success-order .order-item-qty{color:var(--muted);margin-left:8px;}
        .success-order .order-total-row{display:flex;justify-content:space-between;padding-top:10px;margin-top:10px;border-top:1px solid var(--border);font-weight:600;font-size:15px;color:var(--accent);}
        .success-order .order-notes{margin-top:10px;padding-top:10px;border-top:1px solid var(--border);font-size:12px;color:var(--muted);font-style:italic;}
        .toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--ink);color:white;padding:12px 22px;border-radius:30px;font-size:13px;font-weight:500;z-index:3000;transition:transform 0.3s cubic-bezier(0.34,1.56,0.64,1);pointer-events:none;}
        .toast.show{transform:translateX(-50%) translateY(0);}
        select.form-input{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%239e9890' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;}
        @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
        @keyframes modalIn{from{opacity:0;transform:scale(0.92) translateY(16px)}to{opacity:1;transform:scale(1) translateY(0)}}
    </style>
</head>
<body>

<!-- MENU VIEW -->
<div id="view-menu" class="view active">
    <nav class="nav">
        <div class="logo">Wake<span>¬∑</span>Donalds üçî</div>
        <div class="nav-center" id="nav-user"></div>
        <div class="nav-right">
            <button class="btn-admin" id="nav-admin-btn" onclick="showView('admin')" style="display:none">‚öô Admin</button>
            <button class="btn-logout" onclick="logout()">Logout</button>
            <button class="cart-btn" onclick="showView('cart')">
                üõí View Order <span class="cart-count" id="cart-count">0</span>
            </button>
        </div>
    </nav>
    <div class="category-bar" id="category-bar"></div>
    <div class="menu-body" id="menu-body"></div>
</div>

<!-- CART VIEW -->
<div id="view-cart" class="view">
    <div class="page-header">
        <button class="back-btn" onclick="showView('menu')">‚Üê Back to Menu</button>
        <div class="page-title">Your Order</div>
    </div>
    <div class="cart-layout">
        <div class="cart-items-panel">
            <div class="panel-head">Order Items</div>
            <div id="cart-items-list"></div>
        </div>
        <div class="summary-panel">
            <div class="panel-head">Order Summary</div>
            <div class="summary-rows" id="summary-rows"></div>
            <div class="customer-form">
                <label class="form-label">Customer Name</label>
                <input class="form-input" id="customer-name" placeholder="John Smith"/>
                <label class="form-label">Phone Number <span style="color:var(--red)">*</span></label>
                <input class="form-input" id="phone-num" type="tel" inputmode="numeric" maxlength="14" placeholder="(252) 123-4567" required oninput="formatPhoneInput(this)"/>
                <span class="form-hint" id="phone-hint" style="display:none;font-size:11px;color:var(--muted);margin-top:-8px;margin-bottom:8px;">10 digits, numbers only</span>
                <label class="form-label">Special Notes</label>
                <input class="form-input" id="special-notes" placeholder="Allergies, preferences‚Ä¶"/>
                <button class="checkout-btn" onclick="placeOrder()">Place Order ‚Üí</button>
            </div>
        </div>
    </div>
</div>

<!-- ADMIN VIEW -->
<div id="view-admin" class="view">
    <div class="page-header">
        <button class="back-btn" onclick="showView('menu')">‚Üê Back to Menu</button>
        <div class="page-title">Admin Panel</div>
    </div>
    <div class="admin-layout">
        <aside class="admin-sidebar">
            <div class="sidebar-logo">Wake<span>¬∑</span>Donalds</div>
            <div class="sidebar-link active" onclick="switchAdminTab('overview',this)"><span>üìä</span> Overview</div>
            <div class="sidebar-link" onclick="switchAdminTab('menu-mgmt',this)"><span>üçΩÔ∏è</span> Menu Items</div>
            <div class="sidebar-link" onclick="switchAdminTab('orders',this)"><span>üßæ</span> Orders</div>
        </aside>
        <main class="admin-main">
            <div class="admin-section active" id="section-overview">
                <h2 class="admin-h2" style="margin-bottom:20px">Dashboard</h2>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-label">Today's Revenue</div><div class="stat-value" id="stat-revenue">$0</div><div class="stat-sub" id="stat-rev-sub">+0 orders today</div></div>
                    <div class="stat-card"><div class="stat-label">Total Orders</div><div class="stat-value" id="stat-orders">0</div><div class="stat-sub">Since opening</div></div>
                    <div class="stat-card"><div class="stat-label">Menu Items</div><div class="stat-value" id="stat-items">0</div><div class="stat-sub">Active items</div></div>
                    <div class="stat-card"><div class="stat-label">Avg. Order</div><div class="stat-value" id="stat-avg">$0</div><div class="stat-sub">Per customer</div></div>
                </div>
                <div class="admin-h2" style="font-size:20px;margin-bottom:14px">Recent Orders</div>
                <table class="admin-table"><thead><tr><th>Order #</th><th>Customer</th><th>Phone</th><th>Items</th><th>Total</th><th>Status</th></tr></thead><tbody id="recent-orders-body"></tbody></table>
            </div>
            <div class="admin-section" id="section-menu-mgmt">
                <div class="admin-toolbar"><h2 class="admin-h2">Menu Items</h2><button class="btn-primary" onclick="openAddModal()">+ Add Item</button></div>
                <table class="admin-table"><thead><tr><th>Item</th><th>Category</th><th>Price</th><th>Status</th><th>Actions</th></tr></thead><tbody id="admin-menu-body"></tbody></table>
            </div>
            <div class="admin-section" id="section-orders">
                <h2 class="admin-h2" style="margin-bottom:20px">All Orders</h2>
                <table class="admin-table"><thead><tr><th>Order #</th><th>Customer</th><th>Phone</th><th>Items</th><th>Total</th><th>Status</th></tr></thead><tbody id="all-orders-body"></tbody></table>
            </div>
        </main>
    </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="item-modal">
    <div class="modal">
        <div class="modal-title" id="modal-title">Add Menu Item</div>
        <div class="modal-grid">
            <div class="full"><label class="form-label">Item Name</label><input class="form-input" id="mi-name" placeholder="e.g. Burger"/></div>
            <div><label class="form-label">Category</label>
                <select class="form-input" id="mi-category">
                    <option value="Starters">Starters</option>
                    <option value="Mains">Mains</option>
                    <option value="Pasta & Risotto">Pasta & Risotto</option>
                    <option value="Desserts">Desserts</option>
                    <option value="Drinks">Drinks</option>
                </select>
            </div>
            <div><label class="form-label">Price ($)</label><input class="form-input" id="mi-price" type="number" placeholder="9.99" step="0.01"/></div>
            <div class="full"><label class="form-label">Description</label><input class="form-input" id="mi-desc" placeholder="Brief description‚Ä¶"/></div>
            <div><label class="form-label">Emoji Icon</label><input class="form-input" id="mi-emoji" placeholder="üçî"/></div>
            <div><label class="form-label">Tag</label>
                <select class="form-input" id="mi-tag">
                    <option value="">None</option>
                    <option value="popular">‚≠ê Popular</option>
                    <option value="veg">üåø Vegetarian</option>
                    <option value="spicy">üå∂Ô∏è Spicy</option>
                </select>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeModal()">Cancel</button>
            <button class="btn-primary" onclick="saveItem()">Save Item</button>
        </div>
    </div>
</div>

<!-- SUCCESS -->
<div class="success-overlay" id="success-overlay">
    <div class="success-card">
        <div class="success-icon">‚úÖ</div>
        <div class="success-title">Order Placed!</div>
        <div class="success-sub">Your order has been sent to the kitchen.<br>We'll have it ready shortly.</div>
        <div class="success-order" id="success-details"></div>
        <button class="checkout-btn" onclick="closeSuccess()">Back to Menu</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚úÖ AUTH GUARD ‚Äî allows BOTH logged-in users AND guests
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const userData = localStorage.getItem("wakedonald_user")

// If nothing in localStorage at all ‚Üí go back to login
if (!userData) {
    window.location.href = "index.html"
}

const user = JSON.parse(userData)

// Show name in nav ‚Äî works for both guest and real user
document.getElementById("nav-user").textContent = "üëã " + user.name
// Roles: admin, customer, staff (only these three; normalize from DB "Admin" -> "admin")
function normalizeRole(r) {
    const s = (r || "").toLowerCase()
    return s === "admin" || s === "staff" ? s : "customer"
}
user.role = normalizeRole(user.role)
if (user.email === "admin@wakedonalds.com" && user.role === "customer") user.role = "admin"
const canAccessAdmin = user.role === "admin" || user.role === "staff"
if (canAccessAdmin) {
    const btn = document.getElementById("nav-admin-btn")
    if (btn) btn.style.display = "inline-block"
}

// Logout clears storage and goes back to login
function logout() {
    localStorage.removeItem("wakedonald_user")
    window.location.href = "index.html"
}

// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DEFAULT_MENU = [
    { id:1,  name:"Fries",                  cat:"Starters",        price:5,  desc:"Crispy golden fries",                                          emoji:"üçü", tag:"popular", active:true },
    { id:2,  name:"Crunchwrap Supreme",     cat:"Mains",           price:9,  desc:"Flour tortilla, seasoned beef, nacho cheese, lettuce, tomato", emoji:"üåØ", tag:"popular", active:true },
    { id:3,  name:"Tonkotsu Ramen",         cat:"Mains",           price:14, desc:"Rich pork broth, noodles, chashu pork, soft-boiled egg",       emoji:"üçú", tag:"",        active:true },
    { id:4,  name:"Chicken Filet Sandwich", cat:"Mains",           price:10, desc:"Crispy chicken filet, lettuce, pickles, brioche bun",          emoji:"ü•™", tag:"popular", active:true },
    { id:5,  name:"Burger",                 cat:"Mains",           price:11, desc:"Beef patty, cheese, lettuce, tomato, special sauce",           emoji:"üçî", tag:"",        active:true },
    { id:6,  name:"Hot Dog",                cat:"Mains",           price:7,  desc:"All-beef frank, mustard, ketchup, relish",                     emoji:"üå≠", tag:"",        active:true },
    { id:7,  name:"Spicy Pasta",            cat:"Pasta & Risotto", price:12, desc:"Rigatoni, spicy tomato sauce, parmigiano",                     emoji:"üçù", tag:"spicy",   active:true },
    { id:8,  name:"Mac & Cheese",           cat:"Pasta & Risotto", price:10, desc:"Creamy cheddar sauce, elbow pasta, breadcrumb topping",        emoji:"üßÄ", tag:"popular", active:true },
    { id:9,  name:"Ice Cream",              cat:"Desserts",        price:4,  desc:"Vanilla soft serve, cone or cup",                              emoji:"üç¶", tag:"popular", active:true },
    { id:10, name:"Chocolate Brownie",      cat:"Desserts",        price:5,  desc:"Warm fudge brownie, powdered sugar",                           emoji:"üç´", tag:"",        active:true },
    { id:11, name:"Apple Pie",              cat:"Desserts",        price:4,  desc:"Flaky crust, cinnamon apple filling",                          emoji:"ü•ß", tag:"",        active:true },
    { id:12, name:"Water",                  cat:"Drinks",          price:1,  desc:"Cold bottled water",                                           emoji:"üíß", tag:"",        active:true },
    { id:13, name:"Soda",                   cat:"Drinks",          price:3,  desc:"Coke, Sprite, or Dr. Pepper",                                  emoji:"ü•§", tag:"popular", active:true },
    { id:14, name:"Milkshake",              cat:"Drinks",          price:6,  desc:"Vanilla, chocolate, or strawberry",                            emoji:"ü•õ", tag:"",        active:true },
]
const STORAGE_MENU = "wakedonald_menu", STORAGE_CART = "wakedonald_cart", STORAGE_ORDERS = "wakedonald_orders"

function loadMenu() {
    try {
        const raw = localStorage.getItem(STORAGE_MENU)
        if (raw) return JSON.parse(raw)
    } catch (_) {}
    return JSON.parse(JSON.stringify(DEFAULT_MENU))
}
function saveMenu() { localStorage.setItem(STORAGE_MENU, JSON.stringify(menuItems)) }

function loadCart() {
    try {
        const raw = localStorage.getItem(STORAGE_CART)
        if (raw) return JSON.parse(raw)
    } catch (_) {}
    return []
}
function saveCart() { localStorage.setItem(STORAGE_CART, JSON.stringify(cart)) }

function loadOrders() {
    try {
        const raw = localStorage.getItem(STORAGE_ORDERS)
        if (raw) return JSON.parse(raw)
    } catch (_) {}
    return []
}
function saveOrders() { localStorage.setItem(STORAGE_ORDERS, JSON.stringify(orders)) }

let menuItems = loadMenu()
let cart = loadCart()
let orders = loadOrders()
let nextId = Math.max(0, ...menuItems.map(i => i.id)) + 1
let editingId = null, activeCategory = "All"
const TAX = 0.08
const API = window.location.origin

async function loadMenuFromApi() {
    try {
        const r = await fetch(API + '/api/menu')
        const data = await r.json()
        if (Array.isArray(data) && data.length >= 5) {
            menuItems = data
            nextId = Math.max(0, ...menuItems.map(i => i.id)) + 1
            saveMenu()
            return true
        }
    } catch (_) {}
    return false
}

// ‚îÄ‚îÄ VIEWS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showView(name) {
    if (name === 'admin' && !canAccessAdmin) return
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'))
    document.getElementById('view-' + name).classList.add('active')
    if (name === 'menu')  renderMenu()
    if (name === 'cart')  renderCart()
    if (name === 'admin') renderAdmin()
}

// ‚îÄ‚îÄ MENU ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderMenu() {
    const cats = ['All', ...new Set(menuItems.filter(i => i.active).map(i => i.cat))]
    document.getElementById('category-bar').innerHTML = cats.map(c =>
        `<button class="cat-tab ${c===activeCategory?'active':''}" onclick="setCategory('${c}')">${c}</button>`
    ).join('')
    renderMenuItems()
}

function setCategory(cat) { activeCategory = cat; renderMenu() }

function renderMenuItems() {
    const filtered = activeCategory === 'All'
        ? menuItems.filter(i => i.active)
        : menuItems.filter(i => i.active && i.cat === activeCategory)

    const byCategory = {}
    filtered.forEach(item => {
        if (!byCategory[item.cat]) byCategory[item.cat] = []
        byCategory[item.cat].push(item)
    })

    document.getElementById('menu-body').innerHTML = Object.entries(byCategory).map(([cat, items], ci) => `
        <div>
            <div class="section-title">${cat}</div>
            <div class="section-sub">${items.length} item${items.length!==1?'s':''}</div>
            <div class="menu-grid">
                ${items.map((item, i) => `
                    <div class="menu-card" style="animation-delay:${(ci*4+i)*0.05}s">
                        <div class="menu-card-img">${item.emoji||'üçΩÔ∏è'}</div>
                        <div class="menu-card-body">
                            <div class="menu-card-top">
                                <div class="menu-card-name">${item.name}</div>
                                <div class="menu-card-price">$${Number(item.price).toFixed(2)}</div>
                            </div>
                            <div class="menu-card-desc">${item.desc}</div>
                            ${item.tag==='popular'?'<span class="tag tag-popular">‚≠ê Popular</span>':''}
                            ${item.tag==='veg'    ?'<span class="tag tag-veg">üåø Veg</span>'      :''}
                            ${item.tag==='spicy'  ?'<span class="tag tag-spicy">üå∂Ô∏è Spicy</span>' :''}
                            <button class="add-btn" data-id="${item.id}" onclick="addToCart(this)">+ Add to Order</button>
                        </div>
                    </div>`).join('')}
            </div>
        </div>`).join('')
    updateCartBadge()
}

// ‚îÄ‚îÄ CART ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addToCart(btnOrId) {
    const id = typeof btnOrId === 'object' && btnOrId && btnOrId.getAttribute ? btnOrId.getAttribute('data-id') : btnOrId
    if (id === undefined || id === null) return
    const numId = Number(id)
    const item = menuItems.find(i => Number(i.id) === numId || i.id === id)
    if (!item) return
    const existing = cart.find(c => Number(c.id) === numId || c.id === id)
    if (existing) existing.qty++
    else cart.push({...item, qty:1})
    saveCart()
    updateCartBadge()
    showToast(`${item.emoji||'üçΩÔ∏è'} ${item.name} added to order`)
}

function updateCartBadge() {
    document.getElementById('cart-count').textContent = cart.reduce((s,i)=>s+i.qty, 0)
}

function renderCart() {
    const list = document.getElementById('cart-items-list')
    if (cart.length === 0) {
        list.innerHTML = `<div class="empty-cart"><div class="icon">üçΩÔ∏è</div><p>Your order is empty.<br>Head back to the menu to add items.</p></div>`
    } else {
        list.innerHTML = cart.map(item => `
            <div class="cart-item">
                <div class="cart-item-emoji">${item.emoji||'üçΩÔ∏è'}</div>
                <div class="cart-item-info">
                    <div class="cart-item-name">${item.name}</div>
                    <div class="cart-item-unit">$${Number(item.price).toFixed(2)} each</div>
                </div>
                <div class="qty-control">
                    <button class="qty-btn" onclick="changeQty(${item.id},-1)">‚àí</button>
                    <span class="qty-num">${item.qty}</span>
                    <button class="qty-btn" onclick="changeQty(${item.id},1)">+</button>
                </div>
                <div class="cart-item-total">$${(Number(item.price)*item.qty).toFixed(2)}</div>
                <button class="remove-btn" onclick="removeFromCart(${item.id})">‚úï</button>
            </div>`).join('')
    }
    renderSummary()
}

function changeQty(id, delta) {
    const item = cart.find(c => c.id===id)
    if (!item) return
    item.qty += delta
    if (item.qty <= 0) cart = cart.filter(c => c.id!==id)
    saveCart()
    updateCartBadge(); renderCart()
}

function removeFromCart(id) {
    cart = cart.filter(c => c.id!==id)
    saveCart()
    updateCartBadge(); renderCart()
}

function renderSummary() {
    const subtotal = cart.reduce((s,i)=>s+Number(i.price)*i.qty, 0)
    const tax = subtotal * TAX
    const total = subtotal + tax
    document.getElementById('summary-rows').innerHTML = `
        <div class="summary-row"><span>Subtotal</span><span>$${subtotal.toFixed(2)}</span></div>
        <div class="summary-row"><span>Tax (${(TAX*100).toFixed(0)}%)</span><span>$${tax.toFixed(2)}</span></div>
        <div class="summary-row total"><span>Total</span><span class="val">$${total.toFixed(2)}</span></div>`
}

function formatPhoneInput(input) {
    let digits = input.value.replace(/\D/g, '')
    if (digits.length > 10) digits = digits.slice(0, 10)
    if (digits.length <= 3) input.value = digits ? '(' + digits : digits
    else if (digits.length <= 6) input.value = '(' + digits.slice(0,3) + ') ' + digits.slice(3)
    else input.value = '(' + digits.slice(0,3) + ') ' + digits.slice(3,6) + '-' + digits.slice(6)
    const hint = document.getElementById('phone-hint')
    if (hint) hint.style.display = digits.length > 0 && digits.length !== 10 ? 'block' : 'none'
}

function formatPhoneDisplay(phoneStr) {
    const digits = (phoneStr || '').replace(/\D/g, '')
    if (digits.length !== 10) return phoneStr || '‚Äî'
    return '(' + digits.slice(0,3) + ') ' + digits.slice(3,6) + '-' + digits.slice(6)
}

function getPhoneDigits(phoneStr) {
    return (phoneStr || '').replace(/\D/g, '')
}

async function placeOrder() {
    if (cart.length === 0) { showToast('Your cart is empty!'); return }
    const name  = document.getElementById('customer-name').value.trim() || user.name
    const phoneRaw = document.getElementById('phone-num').value.trim()
    const phoneDigits = getPhoneDigits(phoneRaw)
    if (phoneDigits.length !== 10) {
        showToast('Please enter a valid 10-digit phone number')
        document.getElementById('phone-num').focus()
        return
    }
    const phone = formatPhoneDisplay(phoneRaw)
    const notes = document.getElementById('special-notes').value.trim()
    const subtotal = cart.reduce((s,i)=>s+Number(i.price)*i.qty, 0)
    const tax = subtotal * TAX
    const total = subtotal + tax
    let orderNum = String(orders.length + 1001)

    try {
        const r = await fetch(API + '/api/orders', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                customer: name,
                phone: phone,
                notes: notes || null,
                items: cart.map(i => ({ id: i.id, name: i.name, price: i.price, qty: i.qty, emoji: i.emoji })),
                subtotal, tax, total
            })
        })
        if (r.ok) {
            const data = await r.json()
            orderNum = data.orderNum || orderNum
        } else throw new Error('API failed')
    } catch (_) {
        orders.push({ num: orderNum, customer: name, phone, notes, items: [...cart], subtotal, tax, total, status: 'In Progress', time: new Date().toLocaleTimeString() })
        saveOrders()
    }

    document.getElementById('success-details').innerHTML = `
        <div class="order-label">Order number</div>
        <div class="order-value">#${orderNum}</div>
        <div class="order-label">Customer</div>
        <div class="order-value">${name}</div>
        <div class="order-label">Phone</div>
        <div class="order-value">${phone}</div>
        <div class="order-items">
            <div class="order-label">Items</div>
            ${cart.map(i=>`<div class="order-item"><span class="order-item-name">${i.name}<span class="order-item-qty">√ó ${i.qty}</span></span><span>$${(Number(i.price)*i.qty).toFixed(2)}</span></div>`).join('')}
            <div class="order-total-row"><span>Total</span><span>$${total.toFixed(2)}</span></div>
        </div>
        ${notes ? `<div class="order-notes">Note: ${notes}</div>` : ''}`

    document.getElementById('success-overlay').classList.add('open')
    cart = []
    saveCart()
    updateCartBadge()
    document.getElementById('customer-name').value = ''
    document.getElementById('phone-num').value = ''
    document.getElementById('special-notes').value = ''
}

function closeSuccess() {
    document.getElementById('success-overlay').classList.remove('open')
    showView('menu')
}

// ‚îÄ‚îÄ ADMIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function renderAdmin() {
    let orderList = orders
    try {
        const r = await fetch(API + '/api/orders')
        if (r.ok) {
            const data = await r.json()
            if (Array.isArray(data) && data.length >= 0) orderList = data
        }
    } catch (_) {}

    const totalRev = orderList.reduce((s,o)=>s+Number(o.total), 0)
    const avgOrder = orderList.length ? totalRev/orderList.length : 0
    document.getElementById('stat-revenue').textContent = '$'+totalRev.toFixed(2)
    document.getElementById('stat-rev-sub').textContent = `+${orderList.length} orders today`
    document.getElementById('stat-orders').textContent = orderList.length
    document.getElementById('stat-items').textContent = menuItems.filter(i=>i.active).length
    document.getElementById('stat-avg').textContent = '$'+avgOrder.toFixed(2)

    const empty = `<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:30px">No orders yet</td></tr>`

    document.getElementById('recent-orders-body').innerHTML = !orderList.length ? empty :
        orderList.slice(-5).reverse().map(o=>`
            <tr>
                <td><strong>#${o.num}</strong></td><td>${o.customer}</td><td>${o.phone}</td>
                <td>${(o.items||[]).map(i=>`${i.name} √ó${i.qty}`).join(', ')}</td>
                <td><strong>$${Number(o.total).toFixed(2)}</strong></td>
                <td><span class="status-badge badge-active">‚óè ${o.status}</span></td>
            </tr>`).join('')

    document.getElementById('all-orders-body').innerHTML = !orderList.length ? empty :
        orderList.slice().reverse().map(o=>`
            <tr>
                <td><strong>#${o.num}</strong></td><td>${o.customer}</td><td>${o.phone}</td>
                <td>${o.items.map(i=>`${i.name} √ó${i.qty}`).join(', ')}</td>
                <td><strong>$${Number(o.total).toFixed(2)}</strong></td>
                <td><span class="status-badge badge-active">‚óè ${o.status}</span></td>
            </tr>`).join('')

    renderAdminMenuTable()
}

function renderAdminMenuTable() {
    document.getElementById('admin-menu-body').innerHTML = menuItems.map(item=>`
        <tr>
            <td>${item.emoji||'üçΩÔ∏è'} <strong>${item.name}</strong></td>
            <td>${item.cat}</td>
            <td>$${Number(item.price).toFixed(2)}</td>
            <td><span class="status-badge ${item.active?'badge-active':'badge-off'}">‚óè ${item.active?'Active':'Off Menu'}</span></td>
            <td>
                <div class="action-btns">
                    <button class="icon-btn" onclick="openEditModal(${item.id})">‚úè Edit</button>
                    <button class="icon-btn" onclick="toggleItem(${item.id})">${item.active?'üö´ Disable':'‚úÖ Enable'}</button>
                    <button class="icon-btn danger" onclick="deleteItem(${item.id})">üóë</button>
                </div>
            </td>
        </tr>`).join('')
    document.getElementById('stat-items').textContent = menuItems.filter(i=>i.active).length
}

function switchAdminTab(name, el) {
    document.querySelectorAll('.admin-section').forEach(s=>s.classList.remove('active'))
    document.getElementById('section-'+name).classList.add('active')
    document.querySelectorAll('.sidebar-link').forEach(l=>l.classList.remove('active'))
    el.classList.add('active')
}

async function toggleItem(id) {
    const item = menuItems.find(i=>i.id===id)
    item.active = !item.active
    try {
        const r = await fetch(API + '/api/menu/' + id, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: item.name, cat: item.cat, price: item.price, description: item.desc, emoji: item.emoji, tag: item.tag, active: item.active })
        })
        if (!r.ok) throw new Error()
    } catch (_) { /* fallback: localStorage only */ }
    saveMenu()
    renderAdminMenuTable()
    showToast(`${item.name} ${item.active?'enabled':'disabled'}`)
}

async function deleteItem(id) {
    const item = menuItems.find(i=>i.id===id)
    if (!confirm(`Delete "${item.name}"?`)) return
    try {
        const r = await fetch(API + '/api/menu/' + id, { method: 'DELETE' })
        if (!r.ok) throw new Error()
    } catch (_) { /* fallback: local only */ }
    menuItems = menuItems.filter(i=>i.id!==id)
    saveMenu()
    renderAdminMenuTable()
    showToast('Item deleted')
}

// ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openAddModal() {
    editingId = null
    document.getElementById('modal-title').textContent = 'Add Menu Item'
    ;['mi-name','mi-desc','mi-price'].forEach(id=>document.getElementById(id).value='')
    document.getElementById('mi-emoji').value='üçΩÔ∏è'
    document.getElementById('mi-tag').value=''
    document.getElementById('mi-category').value='Mains'
    document.getElementById('item-modal').classList.add('open')
}

function openEditModal(id) {
    const item = menuItems.find(i=>i.id===id)
    editingId = id
    document.getElementById('modal-title').textContent = 'Edit Menu Item'
    document.getElementById('mi-name').value  = item.name
    document.getElementById('mi-desc').value  = item.desc
    document.getElementById('mi-price').value = item.price
    document.getElementById('mi-emoji').value = item.emoji
    document.getElementById('mi-tag').value   = item.tag
    document.getElementById('mi-category').value = item.cat
    document.getElementById('item-modal').classList.add('open')
}

function closeModal() { document.getElementById('item-modal').classList.remove('open') }

async function saveItem() {
    const name  = document.getElementById('mi-name').value.trim()
    const price = parseFloat(document.getElementById('mi-price').value)
    if (!name || isNaN(price)) { showToast('Please fill name and price'); return }
    const data = { name, price, cat: document.getElementById('mi-category').value, description: document.getElementById('mi-desc').value, emoji: document.getElementById('mi-emoji').value||'üçΩÔ∏è', tag: document.getElementById('mi-tag').value, active: true }
    if (editingId) {
        let savedToDb = false
        try {
            const r = await fetch(API + '/api/menu/' + editingId, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) })
            savedToDb = r.ok
            if (!r.ok) throw new Error()
        } catch (_) { }
        Object.assign(menuItems.find(i=>i.id===editingId), { ...data, desc: data.description })
        showToast(savedToDb ? 'Item updated (saved to database)' : 'Item updated (local only)')
    } else {
        let savedToDb = false
        try {
            const r = await fetch(API + '/api/menu', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) })
            if (r.ok) {
                const d = await r.json()
                const newId = d.id != null ? Number(d.id) : (Math.max(0, ...menuItems.map(i => Number(i.id) || 0)) + 1)
                menuItems.push({ id: newId, ...data, desc: data.description })
                nextId = Math.max(nextId, newId + 1)
                savedToDb = true
            } else throw new Error()
        } catch (_) {
            const maxId = Math.max(0, ...menuItems.map(i => Number(i.id) || 0))
            const newId = maxId + 1
            menuItems.push({ id: newId, ...data, desc: data.description })
            nextId = newId + 1
        }
        showToast(savedToDb ? 'Item added (saved to database)' : 'Item added (local only ‚Äî start server with MySQL to save to DB)')
    }
    saveMenu()
    closeModal()
    renderAdminMenuTable()
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg) {
    const t = document.getElementById('toast')
    t.textContent = msg
    t.classList.add('show')
    setTimeout(()=>t.classList.remove('show'), 2200)
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
;(async function() {
    await loadMenuFromApi()
    if (menuItems.length < 5) {
        menuItems = JSON.parse(JSON.stringify(DEFAULT_MENU))
        nextId = Math.max(0, ...menuItems.map(i => i.id)) + 1
        saveMenu()
    }
    renderMenu()
})()
</script>
</body>
</html>